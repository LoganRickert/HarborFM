---
import Layout from '../layouts/Layout.astro';
---

<Layout title="HarborFM - Open source podcast creation" description="Open source podcast creation tool. Build episodes from segments, export RSS and audio. Install via Docker, Docker Compose with Nginx or Caddy, or run locally.">
  <header class="header">
    <div class="header-inner">
      <h1><a href="/"><img src="/favicon.svg" alt="" class="logo-icon" width="24" height="24" /><div class="header-brand-text">HarborFM</div></a></h1>
      <nav class="nav">
        <a href="/updates/">Updates</a>
        <a href="/server/">API (Swagger)</a>
        <a href="https://github.com/LoganRickert/harborfm">GitHub</a>
        <a href="https://app.harborfm.com/">Demo</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-bg" aria-hidden="true"></div>
      <div class="hero-content">
        <img src="/favicon.svg" alt="" class="hero-logo" width="80" height="80" />
        <h1>HarborFM</h1>
        <p class="tagline">Open source podcast creation. Build episodes from segments - record, trim, reorder - then export audio and RSS.</p>
      </div>

      <div class="install-bar" role="region" aria-label="Install options">
        <div class="install-tabs" role="tablist">
          <button type="button" role="tab" aria-selected="true" aria-controls="panel-compose-nginx" id="tab-compose-nginx">Docker Compose + Nginx</button>
          <button type="button" role="tab" aria-selected="false" aria-controls="panel-compose-caddy" id="tab-compose-caddy">Docker Compose + Caddy</button>
          <button type="button" role="tab" aria-selected="false" aria-controls="panel-docker" id="tab-docker">Docker only</button>
          <button type="button" role="tab" aria-selected="false" aria-controls="panel-local" id="tab-local">Install locally</button>
        </div>
        <div class="install-panel" id="panel-compose-nginx" data-active role="tabpanel" aria-labelledby="tab-compose-nginx">
          <div class="code-block-wrap">
            <pre><code>curl -fsSL https://raw.githubusercontent.com/LoganRickert/harborfm/main/install.sh | bash</code></pre>
            <button type="button" class="copy-btn" aria-label="Copy to clipboard">Copy</button>
          </div>
          <p class="help">When prompted, choose <strong>nginx</strong> and enter your domain and Let's Encrypt email. Best for a single domain: nginx, certbot for SSL, optional Fail2Ban. After install, run certbot once to get the cert; use a cron job to renew.</p>
        </div>
        <div class="install-panel" id="panel-compose-caddy" role="tabpanel" aria-labelledby="tab-compose-caddy">
          <div class="code-block-wrap">
            <pre><code>curl -fsSL https://raw.githubusercontent.com/LoganRickert/harborfm/main/install.sh | bash</code></pre>
            <button type="button" class="copy-btn" aria-label="Copy to clipboard">Copy</button>
          </div>
          <p class="help">When prompted, choose <strong>Caddy</strong>. Best for automatic HTTPS and dynamic or multiple hostnames - Caddy obtains and renews TLS certificates with no certbot. Ideal if you want custom subdomains per show or user.</p>
        </div>
        <div class="install-panel" id="panel-docker" role="tabpanel" aria-labelledby="tab-docker">
          <div class="code-block-wrap">
            <pre><code>HARBORFM_SECRETS_KEY=$(openssl rand -base64 32)
JWT_SECRET=$(openssl rand -base64 32)

docker run --name harborfm -p 3001:3001 \
  -v harborfm-data:/data \
  -e HARBORFM_SECRETS_KEY="$HARBORFM_SECRETS_KEY" \
  -e JWT_SECRET="$JWT_SECRET" \
  ghcr.io/loganrickert/harborfm:latest</code></pre>
            <button type="button" class="copy-btn" aria-label="Copy to clipboard">Copy</button>
          </div>
          <p class="help">Runs HarborFM as a single container. Use nginx or Caddy on the host for HTTPS. Open <code>http://localhost:3001</code> and complete the one-time setup from the container logs.</p>
        </div>
        <div class="install-panel" id="panel-local" role="tabpanel" aria-labelledby="tab-local">
          <div class="code-block-wrap">
            <pre><code>git clone https://github.com/LoganRickert/harborfm.git
cd harborfm
pnpm install
pnpm run db:migrate
pnpm run dev</code></pre>
            <button type="button" class="copy-btn" aria-label="Copy to clipboard">Copy</button>
          </div>
          <p class="help">Requires <strong>Node.js 22+</strong>, <strong>pnpm</strong>, <strong>ffmpeg</strong>, and <strong>audiowaveform</strong>. Open the URL shown in the terminal; use the one-time setup link from the server logs to create the admin account.</p>
        </div>
      </div>
    </section>

    <section class="section" id="about">
      <h2>About</h2>
      <p>HarborFM is <strong>free and open source</strong> - a modern replacement for Anchor.fm. Create shows, add episodes, and build each episode from segments: record or upload clips, pull intros and bumpers from a library, trim and reorder, then export a single audio file and RSS feed. The app has PWA support - add it to your home screen and connect to your server.</p>
      <p>Optional: transcripts via Whisper ASR, LLM helpers (Ollama or OpenAI) for copy suggestions, and public feed pages for discovery. Deploy feeds and audio to S3, R2, FTP, SFTP, WebDAV, IPFS, or SMB.</p>
    </section>

    <section class="section" id="features">
      <h2>Features</h2>
      <div class="features">
        <div class="feature-card"><strong>Podcasts & episodes</strong><span>Create shows with metadata, artwork, categories. Add episodes with title, description, season/episode numbers.</span></div>
        <div class="feature-card"><strong>Segments</strong><span>Build each episode from segments: recorded clips or library assets. Trim, split, remove silence; ffmpeg concatenates to final audio.</span></div>
        <div class="feature-card"><strong>Library</strong><span>Upload reusable audio (intros, outros, bumpers). Tag and insert into any episode.</span></div>
        <div class="feature-card"><strong>Transcripts</strong><span>Generate transcripts via Whisper ASR. Optional LLM integration for summaries and copy suggestions.</span></div>
        <div class="feature-card"><strong>RSS & export</strong><span>RSS feed per podcast. Deploy to S3, R2, FTP, SFTP, WebDAV, IPFS, SMB. Only changed files are uploaded.</span></div>
        <div class="feature-card"><strong>Auth & users</strong><span>First-user setup, registration, login, password reset. Optional admin and user management. Public feed pages when enabled.</span></div>
        <div class="feature-card"><strong>API keys</strong><span>Create API keys for programmatic access. Keys are hashed; raw key shown only once on create. Use from Profile.</span></div>
        <div class="feature-card"><strong>Subscription tokens</strong><span>Per-podcast tokenized RSS for private or subscriber-only feeds. Optional validity window and limits per show.</span></div>
        <div class="feature-card"><strong>Automatic DNS</strong><span>Optional Cloudflare integration: managed domains and subdomains so listeners can use custom URLs for your feeds.</span></div>
        <div class="feature-card"><strong>Collaborators</strong><span>Share shows with view, editor, or manager roles. Invite by email; optional platform invites for new users.</span></div>
        <div class="feature-card"><strong>Contact page</strong><span>Built-in contact form; messages stored and optionally emailed to admins. Configurable from settings.</span></div>
        <div class="feature-card"><strong>Analytics & GeoIP</strong><span>Podcast stats: RSS hits, episode requests, listens by location. Optional GeoLite2 for country/city.</span></div>
        <div class="feature-card"><strong>Email & captcha</strong><span>Email verification, password reset, and optional captcha (reCAPTCHA or hCaptcha) for registration and reset.</span></div>
        <div class="feature-card"><strong>Read-only accounts</strong><span>User limits and read-only accounts. Per-user limits for podcasts, episodes, and storage.</span></div>
      </div>
    </section>

    <section class="section" id="screenshots">
      <h2>Screenshots</h2>
      <p>Dashboard, episode editor, recording, and podcast delivery. Click any image to open in a lightbox; click again to close.</p>
      <div class="screenshots-grid">
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshota_0.jpg" aria-label="Open: Dashboard - your shows">
            <img src="/screenshots/screenshota_0.jpg" alt="Dashboard with list of podcast shows" loading="lazy" />
          </button>
          <figcaption>Dashboard - your shows</figcaption>
        </figure>
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshota_3.jpg" aria-label="Open: Episodes - build from segments">
            <img src="/screenshots/screenshota_3.jpg" alt="Episodes page with segment list" loading="lazy" />
          </button>
          <figcaption>Episodes - build from segments</figcaption>
        </figure>
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshota_4.jpg" aria-label="Open: Record a segment">
            <img src="/screenshots/screenshota_4.jpg" alt="Recording a segment" loading="lazy" />
          </button>
          <figcaption>Record a segment</figcaption>
        </figure>
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshota_5.jpg" aria-label="Open: Podcast delivery">
            <img src="/screenshots/screenshota_5.jpg" alt="Podcast delivery settings" loading="lazy" />
          </button>
          <figcaption>Podcast delivery - S3, FTP, etc.</figcaption>
        </figure>
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshota_7.jpg" aria-label="Open: Library">
            <img src="/screenshots/screenshota_7.jpg" alt="Library of reusable audio" loading="lazy" />
          </button>
          <figcaption>Library - intros, bumpers</figcaption>
        </figure>
        <figure>
          <button type="button" class="screenshot-trigger" data-src="/screenshots/screenshot_6.jpg" aria-label="Open: Transcripts and LLM help">
            <img src="/screenshots/screenshot_6.jpg" alt="Transcript and LLM segment help" loading="lazy" />
          </button>
          <figcaption>Transcripts &amp; LLM help</figcaption>
        </figure>
      </div>
    </section>
    <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Screenshot full size" hidden>
      <button type="button" class="lightbox-backdrop" aria-label="Close lightbox"></button>
      <img src="" alt="" class="lightbox-img" />
    </div>

    <section class="section" id="tech-stack">
      <h2>Tech stack</h2>
      <p>Monorepo (pnpm workspaces): <strong>shared</strong> (Zod schemas, types), <strong>server</strong> (Fastify API, SQLite with better-sqlite3, ffmpeg for audio), <strong>web</strong> (React, Vite, TanStack Query). Single Node process serves the API and static web app; no separate database server.</p>
    </section>

    <section class="section" id="project-structure">
      <h2>Project structure</h2>
      <pre><code>harborfm/
├── server/     # API and app entry
├── web/        # React frontend
├── shared/     # Shared schemas and types
├── Dockerfile  # Multi-stage build, Node + ffmpeg
└── pnpm-workspace.yaml</code></pre>
    </section>

    <section class="section" id="requirements">
      <h2>Requirements</h2>
      <p>For local dev: <strong>Node.js 22+</strong>, <strong>pnpm</strong>, <strong>ffmpeg</strong>, <strong>audiowaveform</strong> (e.g. <code>brew install audiowaveform</code> on macOS; on Linux, build from <a href="https://github.com/bbc/audiowaveform" target="_blank" rel="noopener">bbc/audiowaveform</a> or use a package if available). The Docker image includes ffmpeg.</p>
    </section>

    <section class="cta">
      <a href="/server/">Open API docs (Swagger)</a>
      <a href="https://github.com/LoganRickert/harborfm" target="_blank" rel="noopener" style="margin-left: 0.75rem; background: transparent; color: var(--accent); border: 1px solid var(--accent);">GitHub</a>
    </section>

    <footer class="footer">
      <p>License: MIT · Source: <a href="https://github.com/LoganRickert/harborfm">github.com/LoganRickert/harborfm</a> · Demo: <a href="https://app.harborfm.com/">app.harborfm.com</a></p>
    </footer>
  </main>

  <script>
    (function () {
      const tablist = document.querySelector('.install-tabs');
      const panels = document.querySelectorAll('.install-panel');
      if (tablist && panels.length) {
        const tabs = Array.from(tablist.querySelectorAll('button[role="tab"]'));
        const select = (index) => {
          tabs.forEach((t, i) => {
            const panel = panels[i];
            const selected = i === index;
            t.setAttribute('aria-selected', String(selected));
            if (panel) {
              if (selected) panel.setAttribute('data-active', '');
              else panel.removeAttribute('data-active');
            }
          });
        };
        tabs.forEach((tab, index) => {
          tab.addEventListener('click', () => select(index));
          tab.addEventListener('keydown', (e) => {
            let next = index;
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') next = Math.min(index + 1, tabs.length - 1);
            else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') next = Math.max(index - 1, 0);
            else if (e.key === 'Home') next = 0;
            else if (e.key === 'End') next = tabs.length - 1;
            else return;
            if (next !== index) {
              e.preventDefault();
              select(next);
              tabs[next].focus();
            }
          });
        });
      }

      document.querySelectorAll('.copy-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          const wrap = btn.closest('.code-block-wrap');
          const code = wrap?.querySelector('code');
          const text = code?.textContent ?? '';
          navigator.clipboard.writeText(text).then(() => {
            const label = btn.getAttribute('aria-label');
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => {
              btn.textContent = 'Copy';
              btn.classList.remove('copied');
              if (label) btn.setAttribute('aria-label', label);
            }, 2000);
          });
        });
      });

      const lightbox = document.getElementById('lightbox');
      const lightboxImg = lightbox?.querySelector('.lightbox-img');
      const lightboxBackdrop = lightbox?.querySelector('.lightbox-backdrop');
      function closeLightbox() {
        if (lightbox) {
          lightbox.hidden = true;
          if (lightboxImg) lightboxImg.removeAttribute('src');
          document.body.style.overflow = '';
        }
      }
      function openLightbox(src) {
        if (lightbox && lightboxImg) {
          lightboxImg.src = src;
          lightboxImg.alt = 'Screenshot full size';
          lightbox.hidden = false;
          document.body.style.overflow = 'hidden';
        }
      }
      document.querySelectorAll('.screenshot-trigger').forEach((el) => {
        el.addEventListener('click', () => {
          const src = el.getAttribute('data-src');
          if (src) openLightbox(src);
        });
      });
      lightboxBackdrop?.addEventListener('click', closeLightbox);
      lightboxImg?.addEventListener('click', closeLightbox);
      lightbox?.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
      });
    })();
  </script>
</Layout>
